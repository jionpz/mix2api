# Epic 5 Retrospective: 观测治理与发布门禁

## Epic Summary

- Epic: 5（观测治理与发布门禁）
- Stories covered: 5.1, 5.2, 5.3, 5.4
- Completion status: 4/4 stories done, all reviews approved
- Sprint evidence:
  - 日志最小化与字段级脱敏已生效
  - 可选采样留痕与自动过期清理已生效
  - README 与 OpenAPI 契约文档已交付
  - A/B/C 回归包和发布门禁流程已可执行

## Team Participants

- Product/Project Lead: 用户
- Developer: Codex (GPT-5)
- Reviewer: Senior Developer Review (AI workflow)

## Successes and Strengths

- 观测治理从“只约定”落到“可验证实现”，实现默认最小日志与敏感字段脱敏。
- 采样留痕采用默认关闭策略，符合最小暴露原则，同时保留问题复现能力。
- 交付文档覆盖了接入、鉴权、灰度回滚、回归执行、契约校验，降低接入摩擦。
- 回归包 A/B/C 从手工执行升级为统一门禁脚本，发布决策可追溯。

## Challenges and Growth Areas

- 采样留痕当前为进程内内存实现，多实例聚合与跨重启保留能力有限。
- 回归包当前基于测试名模式匹配，对测试命名变更较敏感。
- OpenAPI 当前覆盖主入口，兼容入口说明仍可补充得更显式。
- 结构化日志虽已收敛，后续仍可统一为更严格的 JSON 事件格式。

## Key Insights and Learnings

- “默认关闭 + 显式启用”是处理可观测性与合规性冲突的高性价比策略。
- 先固化门禁脚本再做发布动作，能显著降低发布前人工判断误差。
- 文档与脚本必须同版本演进，否则回归流程会出现认知漂移。
- 低风险审查意见应及时沉淀为下一轮技术债清单，避免长期悬空。

## Previous Retro Follow-through

- N/A：当前仓库尚无上一 Epic retrospective 记录。

## Next Epic Preview and Dependencies

- 当前 Epic 1-5 的 story 已全部完成，研发主线进入“发布与运营收敛”阶段。
- 关键依赖：
  - 继续执行 A/B/C 门禁以保障变更稳定性
  - 逐步演进采样留痕存储方案（如需跨实例）
  - 持续保持文档与实现一致性

## Action Items

- Owner: Developer
  - 将采样留痕从单进程内存演进为可选外部存储方案设计稿（仅在多实例诉求明确时执行）。
- Owner: Developer
  - 将 A/B/C 回归集合从测试名模式匹配演进为更稳定的用例分组机制（文件或标签）。
- Owner: Project Lead
  - 在每次发布前执行 `npm run release:gate -- <channel> <release_tag>` 并保留门禁产物摘要。
- Owner: Developer + Project Lead
  - 将兼容入口说明补充到契约文档或 README，避免集成误解。

## Preparation Tasks for Next Phase

- 固化发布记录模板字段，确保门禁与回滚决策证据链完整。
- 对观测字段做一次“最小必要”复核，确认无新增敏感字段泄露。
- 将关键运行参数（日志、采样、门禁）整理为运维检查清单。

## Critical Path and Discoveries

- Critical path:
  - 最小日志与脱敏策略稳定运行
  - 回归包 A/B/C 全通过
  - 门禁脚本输出可用于发布决策
- Significant discoveries:
  - 先完成门禁自动化再推进发布，显著提升可控性
  - 低成本增强文档可直接降低联调阻塞概率

## Readiness Assessment

- Implementation readiness: Ready
- Operational readiness: Ready（基于门禁通过）
- Documentation readiness: Ready
- Follow-up risk level: Low to Medium（主要在可扩展性与维护性）

## Commitments and Next Steps

- Epic 5 retrospective completed.
- `epic-5-retrospective` 标记为 `done`。
- 后续按需继续执行其他 Epic retrospective（可选），或进入发布执行流程。
